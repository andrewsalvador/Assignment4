---
title: "Assignment 4 Lobsters"
author: "Andrew Salvador & Benson Truong"
date: "11/12/2019"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)

```


```{r}
library(tidyverse)
library(janitor)
library(kableExtra)
```


```{r}
lobster_data <- read_csv("lobster_abundance_sbc_lter.csv") %>% 
  clean_names() 

lobster_data_clean <- lobster_data %>% 
  tidyr::uncount(count) %>% 
  mutate(sitetype = if_else(site %in% c("IVEE", "NAPL"), "MPA", "Non-MPA" )) 

lobster_bysite <- lobster_data_clean %>% 
  count(year, site, sitetype)



```
### Introduction:
The California spiny lobster (*Panulirus interruptus*) is an ecologically important species that has supported valuable commercial and recreational fisheries since the late 1800s (Yaeger et al. 2017). These invertebrates are essential to the giant kelp forests as they prey on kelp-eating sea urchins. Data provided by the Santa Barbara Coastal Long-Term Ecological Research (SBC LTER) program consists of 5 total sampling lobster sites: Arroyo Quemado, Mohawk, Carpinteria, Naples, and Isla Vista (Reed 2019). Out of these 5, Naples and Isla Vista lobster sites are considered Marine Protected Areas (MPA). Studying MPA networks, with varying degrees of protection and use, can help achieve both conservation and fisheries management (Thiault et al. 2019). In this study, the abundance and size of lobsters are presented and analyzed to determine the effects of MPA sites. Specially, the annual lobster abundance for each site, lobster size distribution shifts for 2012 and 2018, and a summary table of sample statistics are presented. 

### Data and Methods:
Data for the California spiny lobster abundance and location from 2012 – 2018 were collected and provided by the SBC LTER program (Reed 2019). Sampling occurred late summer before the start of fishing season at the five kelp forest study sites. Naples and Isla Vista are MPA sites while Arroyo Quemado, Mohawk, and Carpinteria are non MPA sites. The number and sizes of spiny lobster are recorded by divers in four 60 x 5 m lobster transects that are associated with each permanent SBC LTER kelp forest community survey transect. Mean lobster size was compared for MPA and non MPA sites by two-sample t-tests (α = 0.05 throughout). All analyses and figures were prepared using R software version 3.6.1.

### Results {.tabset .tabset-fade}

#### Results A

Trends in spiny lobster populations were compared for MPA and non MPA sites (Figure 1). Generally, the population size for all sites increased. The populations from MPA sites (IVEE and NAPL) increased more than the non MPA sites since 2012. One of the three non MPA sites (AQUE) experienced the least amount of population increase.  

```{r}
# Results A messing around (probably better) (nEEED TO MAKE A NEW MPA COLUMNN)
lobster_count_graph <- lobster_bysite %>% 
  mutate(year = as.character(year)) 
  

lobster_count_graph$year <- gsub("2012", "'12", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2013", "'13", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2014", "'14", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2015", "'15", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2016", "'16", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2017", "'17", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2018", "'18", lobster_count_graph$year)
  


ggplot(lobster_count_graph, aes(x = year, 
                           y = n)) +
  geom_col(aes(color = sitetype,
               fill = sitetype)) +
  labs(x = "Year",
       y = "Count") +
  scale_y_continuous(limits = c(0,1000), expand = c(0,0)) +
  facet_wrap(~site, scales = "free") 


 


```

***Figure 1.*** *Spiny Lobster population from years 2012 - 2018 for MPA and non MPA sites. MPA sites are colored red while non MPA are colored blue. Data: SBC LTER













#### Results B

Trends in lobster community size structure were compared in 2012 and 2018, when the Marine Protected Areas were established, and six years after. (Figure 2.) Mean size distribution as well as lobster abundance in the MPA sites significantly grew from 2012 to 2018, while mean size distribution did not change significantly in Non-MPA sites. 

```{r}
# RESULTS B
# For 2012
lobster_data_2012 <- lobster_data_clean %>% 
  filter(year == "2012")

ggplot(data = lobster_data_2012, aes(x = size_mm))+
  geom_histogram(aes(fill = site))+
  facet_wrap(~site, scales ="free")+
  scale_y_continuous(limits = c(0,20), expand = c(0,0))+
  scale_x_continuous(limits = c(40,160))+
  labs(x = "Size (mm)", y = "Counts", title = "2012 Lobster Size Distribution")

# For 2018
lobster_data_2018 <- lobster_data_clean %>% 
  filter(year == "2018")

ggplot(data = lobster_data_2018, aes(x = size_mm))+
  geom_histogram(aes(fill = site))+
  facet_wrap(~site, scales = "free")+
  scale_x_continuous(limits = c(40,160))+
  labs(x = "Size (mm)", y = "Counts", title = "2018 Lobster Size Distribution")


  
                
```
***Figure 2.*** *Lobster size distribution 

#### Results C

```{r}
# RESULTS C

# For 2012--------------------------------
lobster_smry_2012 <- lobster_data_2012 %>% 
  group_by(site) %>% 
  summarise(mean_size = mean(size_mm, na.rm = TRUE),
            sd_size= sd(size_mm, na.rm = TRUE),
            sample_n = n())

# Mean size(mm) for Marine Protected Areas (MPA)
lobster_smry_mpa_2012 <- lobster_data_2012 %>% 
  filter(site %in% c("IVEE", "NAPL")) 
mean_mpa_2012 <- mean(lobster_smry_mpa_2012$size_mm, na.rm = TRUE)


# Mean size(mm) for Non-Marine Protected Areas (Non-MPA)
lobster_smry_non_mpa_2012 <- lobster_data_2012 %>% 
  filter(site %in% c("AQUE", "MOHK", "CARP"))
mean_non_mpa_2012 <- mean(lobster_smry_non_mpa_2012$size_mm, na.rm = TRUE)
            
  

##For 2018---------------------------------
lobster_smry_2018 <- lobster_data_2018 %>% 
  group_by(site) %>% 
  summarise(mean_size = mean(size_mm, na.rm = TRUE),
            sd_size= sd(size_mm, na.rm = TRUE),
            sample_n = n())

# Mean size(mm) for Marine Protected Areas (MPA)
lobster_smry_mpa_2018 <- lobster_data_2018 %>% 
  filter(site %in% c("IVEE", "NAPL"))
mean_mpa_2018 <- mean(lobster_smry_mpa_2018$size_mm, na.rm = TRUE)

# Mean size(mm) for Non-Marine Protected Areas (Non-MPA)
lobster_smry_non_mpa_2018 <- lobster_data_2018 %>% 
  filter(site %in% c("AQUE", "MOHK", "CARP"))
mean_non_mpa_2018 <- mean(lobster_smry_non_mpa_2018$size_mm, na.rm = TRUE)


  

  
```

```{r}
# MPA Lobsters 2012
#One sample t-test..
mpa_lobsters_2012 <- lobster_smry_mpa_2012 %>% 
  filter(site %in% c("IVEE", "NAPL")) %>% 
  pull(size_mm)

t.test(mpa_lobsters_2012)
```

```{r}
#MPA Lobsters 2018
mpa_lobsters_2018 <- lobster_smry_mpa_2018 %>% 
  filter(site %in% c("IVEE", "NAPL")) %>% 
  pull(size_mm)

t.test(mpa_lobsters_2018)
```

```{r}
# Non-MPA lobsters 2012

non_mpa_lobsters_2012 <- lobster_smry_non_mpa_2012 %>% 
  pull(size_mm)

t.test(non_mpa_lobsters_2012)

```
```{r}
# Non-MPA lobsters 2018
non_mpa_lobsters_2018 <- lobster_smry_non_mpa_2018 %>% 
  pull(size_mm)

t.test(non_mpa_lobsters_2018)

```

##### 1. For 2012 observations, is there a significant difference in lobster size between MPA and non-MPA sites?

```{r}
#Results C, Question 1.
# 2 sample t-test 2012 MPA vs Non-MPA lobsters
mpa_v_non_mpa_2012_ttest <- t.test(mpa_lobsters_2012, non_mpa_lobsters_2012)
mpa_v_non_mpa_2012_ttest


```

Mean lobster size in MPA vs Non-MPA sites differed significantly in 2012 (t(`r round(mpa_v_non_mpa_2012_ttest$parameter, 2)`) = `r round(mpa_v_non_mpa_2012_ttest$statistic, 2)`, *p* < 0.05).

##### 2. For 2018 observations, is there a significant difference in lobster size between MPA and non-MPA sites?

```{r}
#Results C, Question 2. 
mpa_v_non_mpa_2018_ttest <- t.test(mpa_lobsters_2018, non_mpa_lobsters_2018)
mpa_v_non_mpa_2018_ttest
```

Mean lobster size in MPA vs Non-MPA sites differed significantly in 2018 (t(`r round(mpa_v_non_mpa_2018_ttest$parameter, 2)`) = `r round(mpa_v_non_mpa_2018_ttest$statistic, 2)`, *p* < 0.05).


##### 3. For MPA sites only, is there a significant mean size difference in lobsters observed in 2012 vs. 2018?
```{r}
# Results C, Question 3. 
# 2 Sample t-test MPA lobsters 2012 and 2018
mpa_2012_2018_ttest <- t.test(mpa_lobsters_2012, mpa_lobsters_2018)
mpa_2012_2018_ttest
```

Mean lobster size in MPA sites differed significantly from 2012 to 2018 (t(`r round(mpa_2012_2018_ttest$parameter, 2)`) = `r round(mpa_2012_2018_ttest$statistic, 2)`, *p* < 0.05).


##### 4. For non-MPA sites only, is there a significant mean size difference in lobsters observed in 2012 vs. 2018?

```{r}
# Results C, question 4.
# 2 sample t-test Non-MPA sites 2012 vs. 2018

non_mpa_2012_2018_ttest <- t.test(non_mpa_lobsters_2012, non_mpa_lobsters_2018)
non_mpa_2012_2018_ttest

```
Mean lobster size in Non-MPA sites do not differ significantly from 2012 to 2018 (t(`r round(non_mpa_2012_2018_ttest$parameter, 2)`) = `r round(non_mpa_2012_2018_ttest$statistic, 2)`, *p* > 0.05).


```{r}

lobster_summary <- lobster_data_clean %>% 
  filter(year %in% c("2012", "2018")) %>% 
  group_by(site, year) %>% 
  filter(site %in% c("IVEE", "NAPL")) %>% 
  summarize(
    mean_size = mean(size_mm, na.rm = TRUE),
    sd_size = sd(size_mm, na.rm = TRUE),
    sample_n = n()
  )
  


```

```{r}
# For 2012
lobster_table_2012 <- lobster_data_clean %>%
  filter(year == "2012") %>% 
  group_by(site) %>% 
  summarize(
    mean_size = mean(size_mm, na.rm = TRUE),
    sd_size = sd(size_mm, na.rm = TRUE),
    sample_n = n())

# For 2018
lobster_table_2018 <- lobster_data_clean %>% 
  filter(year == "2018") %>% 
  group_by(site) %>% 
  summarize(
    mean_size = mean(size_mm, na.rm = TRUE),
    sd_size = sd(size_mm, na.rm = TRUE),
    sample_n = n())

lobster_table_2012 %>% 
  kable(col.names = c("Site", 
                     "Mean Size", 
                     "Standard Deviation", 
                     "Sample Size")
        ) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center"
  ) %>% 
  add_header_above(c("2012 Lobster Size Summary" = 4)) %>% 
  row_spec(3, bold = T, color = "white", background = "#D7261E") %>% 
  row_spec(5, bold = T, color = "white", background = "#D7261E")



lobster_table_2018 %>% 
    kable(col.names = c("Site", 
                     "Mean Size", 
                     "Standard Deviation", 
                     "Sample Size")
        ) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center"
  ) %>% 
    add_header_above(c("2018 Lobster Size Summary" = 4)) %>% 
    row_spec(3, bold = T, color = "white", background = "#D7261E") %>% 
    row_spec(5, bold = T, color = "white", background = "#D7261E")
```





### Summary:

### References:
**Reed D. 2019.** SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012. Environmental Data Initiative. https://doi.org/10.6073/pasta/a593a675d644fdefb736750b291579a0. Dataset accessed 11/17/2019.

**Thiault, L., Kernaleguen, L., Osenberg, C. W., Lison de Loma, T., Chancerelle, Y., Siu, G., and Claudet, J.. 2019.** Ecological evaluation of a marine protected area network: a progressive‐change BACIPS approach. Ecosphere 10(2)

**Yaeger, K., Culver, C., Schroeter, S., Page, H. (2017).** Utility of a Collaborative At-Sea Sampling Program (CASP) for the California Spiny Lobster Commercial Fishery: Catch Characteristics and Implications for Management. Marine and Coastal Fisheries 9(1): 190-202.
















```{r}
ggplot(aes(x = size_mm))+
  geom_histogram(data = lobster_data_2012, aes(fill = site))+
  geom_historgram(data = lobster_data_2018, aes(fill =site))
```












 


