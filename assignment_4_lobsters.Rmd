---
title: "Assignment 4 Lobsters"
author: "Andrew Salvador & Benson Truong"
date: "11/12/2019"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)

```


```{r}
library(tidyverse)
library(janitor)
library(kableExtra)
```


```{r}
lobster_data <- read_csv("lobster_abundance_sbc_lter.csv") %>% 
  clean_names() 

lobster_data_clean <- lobster_data %>% 
  tidyr::uncount(count) %>% 
  mutate(sitetype = if_else(site %in% c("IVEE", "NAPL"), "MPA", "Non-MPA" )) 

lobster_bysite <- lobster_data_clean %>% 
  count(year, site, sitetype)



```
### Introduction:

### Data and Methods:

### Results {.tabset .tabset-fade}

#### Results A

```{r}
# Results A messing around (probably better) (nEEED TO MAKE A NEW MPA COLUMNN)
lobster_count_graph <- lobster_bysite %>% 
  mutate(year = as.character(year)) 
  

lobster_count_graph$year <- gsub("2012", "'12", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2013", "'13", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2014", "'14", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2015", "'15", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2016", "'16", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2017", "'17", lobster_count_graph$year)
lobster_count_graph$year <- gsub("2018", "'18", lobster_count_graph$year)
  


ggplot(lobster_count_graph, aes(x = year, 
                           y = n)) +
  geom_col(aes(color = site,
               fill = site)) +
  labs(x = "Year",
       y = "Count") +
  scale_y_continuous(limits = c(0,1000), expand = c(0,0)) +
  facet_wrap(~site) 


 


```














#### Results B

```{r}
# RESULTS B
# For 2012
lobster_data_2012 <- lobster_data_clean %>% 
  filter(year == "2012")

ggplot(data = lobster_data_2012, aes(x = size_mm))+
  geom_histogram(aes(fill = site))+
  facet_wrap(~site, scales ="free")+
  labs(x = "Size (mm)", y = "Counts", title = "2012 Lobster Size Distribution")

# For 2018
lobster_data_2018 <- lobster_data_clean %>% 
  filter(year == "2018")

ggplot(data = lobster_data_2018, aes(x = size_mm))+
  geom_histogram(aes(fill = site))+
  facet_wrap(~site, scales = "free")+
  labs(x = "Size (mm)", y = "Counts", title = "2018 Lobster Size Distribution")
                
```


#### Results C

```{r}
# RESULTS C

# For 2012--------------------------------
lobster_smry_2012 <- lobster_data_2012 %>% 
  group_by(site) %>% 
  summarise(mean_size = mean(size_mm, na.rm = TRUE),
            sd_size= sd(size_mm, na.rm = TRUE),
            sample_n = n())

# Mean size(mm) for Marine Protected Areas (MPA)
lobster_smry_mpa_2012 <- lobster_data_2012 %>% 
  filter(site %in% c("IVEE", "NAPL")) 
mean_mpa_2012 <- mean(lobster_smry_mpa_2012$size_mm, na.rm = TRUE)


# Mean size(mm) for Non-Marine Protected Areas (Non-MPA)
lobster_smry_non_mpa_2012 <- lobster_data_2012 %>% 
  filter(site %in% c("AQUE", "MOHK", "CARP"))
mean_non_mpa_2012 <- mean(lobster_smry_non_mpa_2012$size_mm, na.rm = TRUE)
            
  

##For 2018---------------------------------
lobster_smry_2018 <- lobster_data_2018 %>% 
  group_by(site) %>% 
  summarise(mean_size = mean(size_mm, na.rm = TRUE),
            sd_size= sd(size_mm, na.rm = TRUE),
            sample_n = n())

# Mean size(mm) for Marine Protected Areas (MPA)
lobster_smry_mpa_2018 <- lobster_data_2018 %>% 
  filter(site %in% c("IVEE", "NAPL"))
mean_mpa_2018 <- mean(lobster_smry_mpa_2018$size_mm, na.rm = TRUE)

# Mean size(mm) for Non-Marine Protected Areas (Non-MPA)
lobster_smry_non_mpa_2018 <- lobster_data_2018 %>% 
  filter(site %in% c("AQUE", "MOHK", "CARP"))
mean_non_mpa_2018 <- mean(lobster_smry_non_mpa_2018$size_mm, na.rm = TRUE)


  

  
```

```{r}
# MPA Lobsters 2012
#One sample t-test..
mpa_lobsters_2012 <- lobster_smry_mpa_2012 %>% 
  filter(site %in% c("IVEE", "NAPL")) %>% 
  pull(size_mm)

t.test(mpa_lobsters_2012)
```

```{r}
#MPA Lobsters 2018
mpa_lobsters_2018 <- lobster_smry_mpa_2018 %>% 
  filter(site %in% c("IVEE", "NAPL")) %>% 
  pull(size_mm)

t.test(mpa_lobsters_2018)
```

```{r}
# Non-MPA lobsters 2012

non_mpa_lobsters_2012 <- lobster_smry_non_mpa_2012 %>% 
  pull(size_mm)

t.test(non_mpa_lobsters_2012)

```
```{r}
# Non-MPA lobsters 2018
non_mpa_lobsters_2018 <- lobster_smry_non_mpa_2018 %>% 
  pull(size_mm)

t.test(non_mpa_lobsters_2018)

```

##### 1. For 2012 observations, is there a significant difference in lobster size between MPA and non-MPA sites?

```{r}
#Results C, Question 1.
# 2 sample t-test 2012 MPA vs Non-MPA lobsters
mpa_v_non_mpa_2012_ttest <- t.test(mpa_lobsters_2012, non_mpa_lobsters_2012)
mpa_v_non_mpa_2012_ttest


```

Mean lobster size in MPA vs Non-MPA sites differed significantly in 2012 (t(`r round(mpa_v_non_mpa_2012_ttest$parameter, 2)`) = `r round(mpa_v_non_mpa_2012_ttest$statistic, 2)`, *p* < 0.05).

##### 2. For 2018 observations, is there a significant difference in lobster size between MPA and non-MPA sites?

```{r}
#Results C, Question 2. 
mpa_v_non_mpa_2018_ttest <- t.test(mpa_lobsters_2018, non_mpa_lobsters_2018)
mpa_v_non_mpa_2018_ttest
```

Mean lobster size in MPA vs Non-MPA sites differed significantly in 2018 (t(`r round(mpa_v_non_mpa_2018_ttest$parameter, 2)`) = `r round(mpa_v_non_mpa_2018_ttest$statistic, 2)`, *p* < 0.05).


##### 3. For MPA sites only, is there a significant mean size difference in lobsters observed in 2012 vs. 2018?
```{r}
# Results C, Question 3. 
# 2 Sample t-test MPA lobsters 2012 and 2018
mpa_2012_2018_ttest <- t.test(mpa_lobsters_2012, mpa_lobsters_2018)
mpa_2012_2018_ttest
```

Mean lobster size in MPA sites differed significantly from 2012 to 2018 (t(`r round(mpa_2012_2018_ttest$parameter, 2)`) = `r round(mpa_2012_2018_ttest$statistic, 2)`, *p* < 0.05).


##### 4. For non-MPA sites only, is there a significant mean size difference in lobsters observed in 2012 vs. 2018?

```{r}
# Results C, question 4.
# 2 sample t-test Non-MPA sites 2012 vs. 2018

non_mpa_2012_2018_ttest <- t.test(non_mpa_lobsters_2012, non_mpa_lobsters_2018)
non_mpa_2012_2018_ttest

```
Mean lobster size in Non-MPA sites do not differ significantly from 2012 to 2018 (t(`r round(non_mpa_2012_2018_ttest$parameter, 2)`) = `r round(non_mpa_2012_2018_ttest$statistic, 2)`, *p* > 0.05).


```{r}

lobster_summary <- lobster_data_clean %>% 
  filter(year %in% c("2012", "2018")) %>% 
  group_by(site, year) %>% 
  filter(site %in% c("IVEE", "NAPL")) %>% 
  summarize(
    mean_size = mean(size_mm, na.rm = TRUE),
    sd_size = sd(size_mm, na.rm = TRUE),
    sample_n = n()
  )
  


```

